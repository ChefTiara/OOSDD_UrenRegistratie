<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Hourregistration.App.ViewModels"
             xmlns:m="clr-namespace:Hourregistration.Core.Models;assembly=Hourregistration.Core"
             x:Class="Hourregistration.App.Views.EmployeeHoursOverviewView"
             x:DataType="vm:EmployeeHoursOverviewViewModel"
             Title="Urenoverzicht medewerkers">

    <!-- Use Grid so CollectionView can get a star-sized row (and therefore scroll) -->
    <Grid Padding="12" RowSpacing="14" RowDefinitions="Auto,Auto,*,Auto">
        <!-- Row 0: Title + Search + Filters -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto"
              ColumnSpacing="12" HorizontalOptions="Fill">
            <Label Text="Urenoverzicht:"
                   FontSize="22"
                   FontAttributes="Bold"
                   VerticalOptions="Center"
                   HorizontalOptions="Start"/>
            <SearchBar Grid.Column="1"
                       Placeholder="Zoeken op naam..."
                       Text="{Binding SearchText}"
                       HorizontalOptions="Fill"
                       VerticalOptions="Center"/>
            <Picker Grid.Column="2"
                    WidthRequest="130"
                    ItemsSource="{Binding FunctieOptions}"
                    SelectedItem="{Binding SelectedFunctie}"
                    Title="Functie"
                    VerticalOptions="Center"/>
        </Grid>

        <!-- Row 1: Header Row -->
        <Grid Grid.Row="1" HorizontalOptions="Fill"
              ColumnSpacing="12"
              RowDefinitions="Auto"
              ColumnDefinitions="2*,1.2*,1.2*,1.2*,0.8*,0.4*">
            <Label Text="Naam" FontAttributes="Bold"/>
            <Label Grid.Column="1" Text="Functie" FontAttributes="Bold"/>
            <Label Grid.Column="2" Text="Recente declaratie" FontAttributes="Bold"/>
        </Grid>

        <!-- Row 2: CollectionView (star row -> constrained -> scrolls) -->
        <CollectionView Grid.Row="2"
                        ItemsSource="{Binding Users}"
                        SelectionMode="None"
                        HorizontalOptions="Fill"
                        VerticalOptions="Fill">
            <CollectionView.ItemTemplate>
                <!-- use the wrapper type here -->
                <DataTemplate x:DataType="vm:UserListItem">
                    <Grid HeightRequest="38"
                          MinimumHeightRequest="34"
                          ColumnSpacing="12"
                          Padding="6, 4"
                          HorizontalOptions="Fill"
                          VerticalOptions="Center"
                          ColumnDefinitions="2*,1.2*,1.2*,1.2*,0.8*,0.4*">
                        <Label Text="{Binding Username}"
                               VerticalOptions="Center"
                               LineBreakMode="TailTruncation"
                               MaxLines="1"/>
                        <Label Grid.Column="1" Text="{Binding Role}" VerticalOptions="Center"/>
                        <Label Grid.Column="2"
                               Text="{Binding LatestDeclarationDisplay}"
                               TextColor="{Binding LatestDeclarationColor}"
                               VerticalOptions="Center"/>
                        <Button Grid.Column="5"
                                HeightRequest="12"
                                WidthRequest="12"
                                BackgroundColor="Transparent"
                                Padding="0"
                                Clicked="OnEmployeeClicked"
                                VerticalOptions="Center"
                                HorizontalOptions="Center">
                            <Button.ImageSource>
                                <FontImageSource Glyph="&#xE76C;"
                                                 FontFamily="Segoe MDL2 Assets"
                                                 Size="12"
                                                 Color="White" />
                            </Button.ImageSource>
                        </Button>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Row 3: optional footer (if you had one) -->
    </Grid>

</ContentPage>
