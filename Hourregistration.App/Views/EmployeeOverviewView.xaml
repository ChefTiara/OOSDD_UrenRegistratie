<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Hourregistration.App.ViewModels"
             xmlns:m="clr-namespace:Hourregistration.Core.Models;assembly=Hourregistration.Core"
             x:Class="Hourregistration.App.Views.EmployeeOverviewView"
             x:DataType="vm:EmployeeOverviewViewModel"
             Title="Urenoverzicht"
             BackgroundColor="{AppThemeBinding Light={StaticResource Tertiary}, Dark={StaticResource PrimaryDark}}">

    <Grid Padding="12"
          RowDefinitions="Auto,Auto,Auto,*,Auto"
          ColumnDefinitions="*"
          RowSpacing="8">

        <!-- ===================== -->
        <!-- TITEL -->
        <!-- ===================== -->
        <Label Grid.Row="0"
               Text="Urenoverzicht"
               FontAttributes="Bold"
               FontSize="18"
               HorizontalOptions="Center"
               TextColor="{StaticResource OnSurfaceBrush}" />

        <!-- ===================== -->
        <!-- FILTERS + WEEK SELECTOR -->
        <!-- ===================== -->
        <Grid Grid.Row="1"
              ColumnDefinitions="Auto,*,Auto"
              ColumnSpacing="8">

            <!-- Filters -->
            <HorizontalStackLayout Grid.Column="0" Spacing="8">

                <Picker ItemsSource="{Binding ProjectOptions}"
                        SelectedItem="{Binding SelectedProjectOption}"
                        Title="Project"
                        WidthRequest="160" />

                <Picker ItemsSource="{Binding StateOptions}"
                        SelectedItem="{Binding SelectedStateOption}"
                        Title="Status"
                        WidthRequest="120" />

                <VerticalStackLayout Spacing="2">
                    <Label Text="Datum"
                           FontSize="12"
                           Opacity="0.7" />
                    <DatePicker Date="{Binding SelectedDateNonNull}"
                                Format="dd-MM-yyyy"
                                WidthRequest="140" />
                </VerticalStackLayout>

            </HorizontalStackLayout>

            <BoxView Grid.Column="1"
                     BackgroundColor="Transparent" />

            <!-- Week selector -->
            <HorizontalStackLayout Grid.Column="2"
                                   Spacing="6"
                                   HorizontalOptions="End">

                <Button Command="{Binding RefreshCommand}">
                    <Button.ImageSource>
                        <FontImageSource Glyph="&#xE117;"
                                         FontFamily="Segoe MDL2 Assets"
                                         Size="18"
                                         Color="{StaticResource OnSurfaceBrush}" />
                    </Button.ImageSource>
                </Button>

                <Button Command="{Binding PreviousWeekCommand}">
                    <Button.ImageSource>
                        <FontImageSource Glyph="&#xE72B;"
                                         FontFamily="Segoe MDL2 Assets"
                                         Size="18"
                                         Color="{StaticResource OnSurfaceBrush}" />
                    </Button.ImageSource>
                </Button>

                <Frame Padding="6,3"
                       BorderColor="{StaticResource SecondaryBrush}"
                       BackgroundColor="{StaticResource SurfaceBrush}">
                    <Label Text="{Binding WeekLabel}"
                           TextColor="{StaticResource OnSurfaceBrush}" />
                </Frame>

                <Button Command="{Binding NextWeekCommand}">
                    <Button.ImageSource>
                        <FontImageSource Glyph="&#xE72A;"
                                         FontFamily="Segoe MDL2 Assets"
                                         Size="18"
                                         Color="{StaticResource OnSurfaceBrush}" />
                    </Button.ImageSource>
                </Button>

            </HorizontalStackLayout>
        </Grid>

        <!-- ===================== -->
        <!-- HEADER -->
        <!-- ===================== -->
        <Grid Grid.Row="2"
              ColumnSpacing="24"
              ColumnDefinitions="70,90,120,70,140,*,Auto">

            <Label Text="Dag" FontAttributes="Bold" />
            <Label Grid.Column="1" Text="Datum" FontAttributes="Bold" />
            <Label Grid.Column="2" Text="Ingepland" FontAttributes="Bold" />
            <Label Grid.Column="3" Text="Uren" FontAttributes="Bold" />
            <Label Grid.Column="4" Text="Project" FontAttributes="Bold" />
            <Label Grid.Column="5" Text="Beschrijving" FontAttributes="Bold" />
            <Label Grid.Column="6" Text="Status" FontAttributes="Bold"
                   HorizontalOptions="End" />
        </Grid>

        <!-- ===================== -->
        <!-- LIJST -->
        <!-- ===================== -->
        <CollectionView Grid.Row="3"
                        ItemsSource="{Binding DeclaredHoursList}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <Label Text="Geen gewerkte uren gevonden."
                       HorizontalOptions="Center"
                       Opacity="0.6" />
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="m:DeclaredHours">
                    <Frame Margin="4"
                           Padding="8"
                           BackgroundColor="{StaticResource SurfaceBrush}"
                           BorderColor="{StaticResource SecondaryBrush}">

                        <Grid ColumnSpacing="24"
                              ColumnDefinitions="70,90,120,70,140,*,Auto">

                            <Label Text="{Binding Day}" />
                            <Label Grid.Column="1"
                                   Text="{Binding Date, StringFormat='{0:dd-MM-yyyy}'}" />
                            <Label Grid.Column="2"
                                   Text="{Binding PlannedHours}" />
                            <Label Grid.Column="3"
                                   Text="{Binding WorkedHours, StringFormat='{}{0}u'}"
                                   FontAttributes="Bold" />
                            <Label Grid.Column="4"
                                   Text="{Binding ProjectName}"
                                   LineBreakMode="TailTruncation" />
                            <Label Grid.Column="5"
                                   Text="{Binding Description}"
                                   Opacity="0.75"
                                   LineBreakMode="TailTruncation" />

                            <!-- STATUS -->
                            <HorizontalStackLayout Grid.Column="6"
                                                   HorizontalOptions="End"
                                                   Spacing="6">

                                <Label Text="{Binding State}">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Akkoord">
                                            <Setter Property="TextColor" Value="LightGreen" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Geweigerd">
                                            <Setter Property="TextColor" Value="Red" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Verzonden">
                                            <Setter Property="TextColor" Value="{StaticResource OnSurfaceBrush}" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                                <Label FontFamily="Segoe MDL2 Assets"
                                       FontSize="16">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Akkoord">
                                            <Setter Property="Text" Value="&#xE73E;" />
                                            <Setter Property="TextColor" Value="LightGreen" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Geweigerd">
                                            <Setter Property="Text" Value="&#xE711;" />
                                            <Setter Property="TextColor" Value="Red" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding State}" Value="Verzonden">
                                            <Setter Property="Text" Value="&#xE119;" />
                                            <Setter Property="TextColor" Value="{StaticResource OnSurfaceBrush}" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                            </HorizontalStackLayout>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>